# XML Food and Drug Event Reporting System (FAERS) Parser

This repository contains a C++ program for parsing XML files from the FDA Event Reporting System. The program processes and extracts relevant drug, and adverse event information, facilitating integration with [our proposed method](https://github.com/JulesBa-Git/emcAdr) as well as other methods or usage.

## Features

- Parses XML files to extract drug and adverse event data.
- Matches drug names to standardized substances using a mapping file.
- Maps substances to ATC (Anatomical Therapeutic Chemical) codes.
- Provides options for filtering and exporting data based on adverse events.
- Handles large datasets with efficient memory management.

## Prerequisites

### Libraries and Tools

- **[pugixml](https://pugixml.org/):** A lightweight C++ XML processing library used for XML parsing in this project.[[1]](#1)
- **[Diana](https://github.com/fusarolimichele/DiAna):** A repository that aids in mapping drug names to ATC codes.[[2]](#2)

### Build Tools

- A C++17 compatible compiler.
- CMAKE.

## Installation

1. Clone this repository:
   ```bash
   git clone https://github.com/JulesBa-Git/FAERS-xml-parser
   cd FAERS-xml-parser
   ```
2. Install required libraries:
   - Download the [pugixml](https://pugixml.org/) library.
   - Ensure mappings (drug-to-substance and substance-to-ATC) are prepared in the repository (FAERS-xml-parser).

3. Compile the code:
   ```bash
   cmake .
   cmake --build .
   ```

## Usage

The program can process XML files and generate CSV outputs. There are three possibilities. First, you can go from XML quarter FAERS files to CSV containing all patients' substances and all Adverse Events (AEs) experienced by the patients (`--all`). You can also go from XML quarter FAERS files to CSV containing all patients' substances and a specific AE (`--specific <AE>`). Finally, you can go from the CSV file generated by the `--all` option to a CSV file containing only a specific AE (`--csvspecific`).

Ensure the following files are available in the same directory as the executable:
- `ATC_tree.csv`
- `ATC_binder_2024.csv` (from [the DiAna repository](https://osf.io/zqu89/files/osfstorage))

### Command-Line Options

- `--input` (Required): Specifies the name of the input XML or CSV file.
- `--output` (Required): Specifies the desired name of the output CSV file.
- `--all`: Extracts data containing substances of each patient and all AEs for each patient from the XML file.
- `--specific <AE_NAME>`: Extracts data containing substances of each patient and a boolean indicating whether the patient experienced the AE or not.
- `--csvspecific <AE_NAME>`: Filters existing CSV `--all` files to match a specific adverse event.
- `--mapping <FILE_PATH>`: Specifies the path of the Diana mapping file for drug-to-substance matching. When mapping has been processed once, the user can omit this option and use the `-p` option.
- `-v` or `--verbose`: Enables verbose logging.

**Note**: All patients having the word `<AE_NAME>` in one of their experienced AEs will have `true` in their corresponding AE cell.

### Example Commands

1. Extract all data:
   ```bash
   ./FAERSParser --input ADR15Q2.xml --output results.csv --all --mapping ./path/to/drugnames_standardized.csv
   ```

2. Filter for a specific adverse event if mapping has already been processed once:
   ```bash
   ./FAERSParser --input ADR15Q2.xml --output headache_results.csv --specific "headache" -p
   ```

3. Filter for a specific adverse event from the `--all` results:
   ```bash
   ./FAERSParser --input results.csv --output headache_results.csv --csvspecific "headache" -p
   ```

## File Structure

- **`main.cpp`**: Core program logic.
- **Mapping Files**:
  - `drugnames_standardized.csv`: Maps drug names to standardized substances.
  - `ATC_binder_2024.csv`: Maps substances to ATC codes.
  - `ATC_tree.csv`: ATC hierarchy structure from [NIPH website](https://atcddd.fhi.no/atc_ddd_index/). Code to scrape the website into a CSV file can be made available.

## From CSV to R

An R script `csv_to_R_data.R` has been programmed to convert the FAERSParser output to an R dataframe compatible with [our proposed method](https://github.com/JulesBa-Git/emcAdr).

### Usage

```bash
Rscript ./csv_to_R_data.R ./headache_results.csv (optional)<output desired filename>
```

This script stores the CSV file in a format that can be processed by our algorithm in a `.RData` file.

## References

<a id="1">[1]</a>
This software is based on pugixml library [http://pugixml.org](http://pugixml.org). pugixml is Copyright (C) 2006-2018 Arseny Kapoulkine.

<a id="2">[2]</a>
Fusaroli M, Giunchi V. DiAna: Repository for FAERS cleaning and analysis. Published online May 10, 2023. doi:10.17605/OSF.IO/ZQU89

## Contributions

Comments and contributions are welcome! Feel free to submit issues or pull requests to enhance this project.

## Contact

For further questions or support, please contact [jules.bangard@math.unistra.fr](mailto:jules.bangard@math.unistra.fr).

